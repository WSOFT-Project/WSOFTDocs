---
title : AliceScript 4の新機能
summary : この記事では、AliceScript4の変更点と新機能について説明します
date : 2023-12-23
order : 8
---
## 新機能
AliceScript 4(Alice4)は、[Alice3.0](./3-0.md)の後継です。


最新のAliceScriptADKは[AliceScriptのダウンロード](../download.md)からダウンロードできます。

> [!NOTE] ご意見をお寄せください
> AliceScriptの新機能に関するご意見や不具合がある場合、[AliceScript](https://github.com/WSOFT-Project/alicescript)のリポジトリにお寄せください。

#### typeof式
任意のオブジェクトについてその型情報を[Type](../api/alice/type/index.md)型で返す、`typeof`式を導入しました。これは[variable.GetType](../api/variable/gettype.md)メソッドを呼び出すのと同じです。次のように使用します。

```cs title="AliceScript"
string str = "Hello,World";
bool cond = false;

print(typeof(str)); //出力: STRING

Type bolType = typeof(cond);

// bool型は値型なので、falseになる
print(bolType.IsObject); //出力: false
```

この変更は[WSOFT-Project/alicescript#28](https://github.com/WSOFT-Project/alicescript/issues/28)で提案、検討しました。

#### 3値論理
論理演算のどちらかのオペランドが`null`の場合、クリーネの3値論理に従った論理演算を行うようになりました。これにより、null許容[Bool](../api/bool/index.md)型を用いてより複雑な論理演算を行えるようになりました。

3値論理演算の詳しい定義については、[論理演算子#3値論理演算](../general/operators/logical-operators.md#3値論理演算)をご覧ください。

この変更は[WSOFT-Project/alicescript#27](https://github.com/WSOFT-Project/alicescript/issues/27)で提案、検討しました。

#### 式形式の関数
関数の本文が1行で収まる場合、ラムダ式のように波括弧や`return`文を省略して関数を定義できるようになりました。
次の例をご覧ください。

```cs title="AliceScript"
number Pow(number x) => x * x;

// requiresやensuresも使える
number Divide(number x, number y) requires(y != 0) ensures(return != 0) => x / y;
```

この変更は[WSOFT-Project/alicescript#28](https://github.com/WSOFT-Project/alicescript/issues/28)で提案、検討しました。

#### ビット補数演算子
数値型の値にビット補数演算子を適用して、その数値の1の補数を取得できるようになりました。次の例をご覧ください。

```cs title="AliceScript"
number x = 10;

// xの1の補数を取る
number cmpl = ~x;

print(cmpl); //出力: -11
```

この変更は[WSOFT-Project/alicescript#14](https://github.com/WSOFT-Project/alicescript/issues/14)で提案、検討しました。

#### 反復演算子
文字列と配列型に、その値を複数回繰り返した新しいリストを取得できる、反復演算子を導入しました。次の例をご覧ください。

```cs title="AliceScript"
var ary1 = [0, 1, 2];
var ary2 = ary1 * 2;

print(ary2);
//出力: [0, 1, 2, 0, 1, 2]
```

この変更は[WSOFT-Project/alicescript#5](https://github.com/WSOFT-Project/alicescript/issues/5)で提案、検討しました。

#### 集合演算子
配列型同士の間で、左右の配列を集合とみなして集合演算を行えるようになりました。
Alice4では、次の演算ができます。いずれの操作でも、新しい配列が作成されます。

- **結合演算子**: 左の配列の末尾に右の配列を結合する
- **差集合演算子**: 左の配列に対する右の配列の差集合
- **和集合演算子**: 左の配列と右の配列の和集合
- **積集合演算子**: 左の配列と右配列の積集合
- **対象差集合**: 左の配列と右の配列の対称差

次の例をご覧ください。

```cs title="AliceScript"
var a = [1, 2, 3, 4];
var b = [2, 4, 6, 8];

// 結合
array concat = a + b;
print(concat); //出力: [1, 2, 3, 4, 2, 4, 6, 8]

// 差集合
array except = a - b;
print(except); //出力: [1, 3]

// 和集合
array union = a | b;
print(union); //出力: [1, 2, 3, 4, 6, 8]
```

この変更は[WSOFT-Project/alicescript#17](https://github.com/WSOFT-Project/alicescript/issues/17)で提案、検討しました。

#### 配列の範囲構文
配列添字を拡張子、配列の特定範囲を抜き出して処理できる範囲構文を導入しました。
配列添字で開始位置と終了位置を指定すると、その区間の配列をシャローコピーできます。
次の例をご覧ください。

```cs title="AliceScript"
array source = [1, 2, 3, 4, 5];

// インデックス1から2(3のひとつ前)まで取得する
print(source[1..3]); // [2, 3]
```

この変更は[WSOFT-Project/alicescript#12](https://github.com/WSOFT-Project/alicescript/issues/12)で提案、検討しました。

#### 複数個連続した単項演算子
従来、隣接して単項演算子を複数個ならべたときの動作は未定義でした。
Alice4以降では、隣接した単行演算子はオペランドに近い方から処理するようになりました。
つまり、次の2行のコードは等価です。

```cs title="AliceScript"
-+2;

-(+(2));
```
